# 交通可持续指标计算说明

## 1. 载人量（Passenger Throughput）

> 仅供展示。实际上遵循电动车转移模型，总载人量就不会减小。

### 输入
- `car_count` : 小汽车数量
- `ebike_count` : 电动车数量
- `bus_count` : 公交车数量

### 固定参数
```python
P_car_avg  = 1.3   # 平均每辆小汽车载客人数
P_ebike_avg = 1.1  # 平均每辆电动车载客人数
P_bus_avg  = 60    # 平均每辆公交车载客人数
```

### 计算流程
```python
passenger_throughput = (
    P_car_avg   * car_count +
    P_ebike_avg * ebike_count +
    P_bus_avg   * bus_count
)
```

### 输出
- `passenger_throughput` : 载人量 / 人次

---

## 2. CO₂ 排放量（kg）

### 输入
- `car_count` : 小汽车数量
- `ebike_count` : 电动车数量
- `bus_count` : 公交车数量
- `road_length_km` : 道路长度（km）

### 固定参数
```python
EF_car_petrol = 0.131  # kg CO₂ / 车·km（汽油车）
ratio_petrol  = 0.754  # 小汽车中汽油车占比
EF_car_elec   = 0.074  # kg CO₂ / 车·km（电动小汽车）
ratio_elec    = 0.246  # 小汽车中电动占比
EF_ebike      = 0.0066 # kg CO₂ / 车·km（电动自行车）
EF_bus        = 0.44   # kg CO₂ / 车·km（深圳公交为纯电）
```

### 计算流程
```python
co2_emission = (
    EF_car_petrol * ratio_petrol * car_count +
    EF_car_elec   * ratio_elec   * car_count +
    EF_ebike * ebike_count +
    EF_bus   * bus_count
) * road_length_km
```

### 输出
- `co2_emission` : CO₂ 排放量 / kg

---

## 3. 综合安全指数（Safety Index）

### 输入
- `car_count` : 小汽车数量
- `ebike_count` : 电动车数量
- `bus_count` : 公交车数量
- `pedestrian_count` : 行人数量
- `road_length_km` : 道路长度（km）
- `avg_speed_kph` : 平均车速（km/h）

### 固定参数
```python
k_mm = 1.0      # 机动车–机动车冲突系数
k_me = 1.5      # 机动车–电动车冲突系数
k_mp = 2.0      # 机动车–行人冲突系数
k_ee = 0.6      # 电动车–电动车冲突系数
k_ep = 1.2      # 电动车–行人冲突系数
alpha_bus = 2.5 # 公交车等效系数

V0 = 30   # 安全基准速度 km/h
m = 3     # 速度指数

L0 = 1    # 基准长度 km
```

### 计算流程
```python
# 1. 冲突暴露量
car_eq = car_count + alpha_bus * bus_count
exposure_conflict = (
    k_mm * car_eq**2 +
    k_me * car_eq * ebike_count +
    k_mp * car_eq * pedestrian_count +
    k_ee * ebike_count**2 +
    k_ep * ebike_count * pedestrian_count
)

# 2. 速度风险
speed_factor = (avg_speed_kph / V0) ** m

# 3. 长度因子
length_factor = road_length_km / L0

# 4. 综合安全指数
SI_raw = length_factor * exposure_conflict * speed_factor
safety_index = 100 / (1 + SI_raw)  # 0–100，越高越安全
```

### 输出
- `safety_index` : 综合安全指数（0–100，值越高越安全）

---

## 4. 拥堵指数（Congestion Index）
> 这是pcr拟合的公式，原始公式见[拥堵指数非线性方法计算公式](docs/user/拥堵指数计算公式.md)

### 输入
- `ebike_count` : 电动车数量
- `bus_count` : 公交车数量
- `pedestrian_count` : 步行者数量
- `car_count` : 小汽车数量
- `road_length_km` : 道路长度（km）
- `avg_speed_kph` : 平均车速（km/h）
- `road_type_code` : 道路类型代码  
  - 1 = 高速公路  
  - 2 = 主干道  
  - 3 = 次干道  
  - 4 = 支路

### 固定参数
```python
# 拟合参数（主成分回归结果：拥堵指数 = 0.1807 + (0.0356 × PC1) + (-0.0329 × PC2) + (0.0406 × PC3) R方: 0.7024）
Intercept         = 0.1807
Coef_length_km    = 0.0146
Coef_car_count    = 0.0204
Coef_ebike_count  = 0.0319
Coef_bus_count    = 0.0024
Coef_pedestrian   = 0.0204
Coef_avg_speed    = -0.0439
```

### 计算流程
第1步：计算原始拥堵指数
```python
congestion_index = (
    Intercept
    + Coef_length_km   * road_length_km
    + Coef_car_count   * car_count
    + Coef_ebike_count * ebike_count
    + Coef_bus_count   * bus_count
    + Coef_pedestrian  * pedestrian_count
    + Coef_avg_speed   * avg_speed_kph
   